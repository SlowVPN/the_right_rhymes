$(document).ready(function(){$(function(){function e(){var e,n=new google.maps.LatLng(40.650002,-73.949997),t=!("ontouchstart"in document.documentElement),a={zoom:10,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,draggable:t};$.each($(".map-canvas"),function(n){function t(e){$.each(e,function(e,n){if(null!=n&&n.origin){tmpLatLng=new google.maps.LatLng(n.origin.latitude,n.origin.longitude),n.name?markerText="<b>"+n.name+"</b><br><a href='/places/"+n.origin.slug+"/'>"+n.origin.name+"</a>":markerText=n.origin.name;var t=new google.maps.Marker({map:s,position:tmpLatLng,title:markerText,animation:google.maps.Animation.DROP,url:"/places/"+n.origin.slug+"/"});d.extend(tmpLatLng),f(t,s,l,markerText),r.push(t),g.addMarker(t),s.fitBounds(d)}})}function o(e){$.each(e,function(e,n){if(null!=n&&n.latitude){tmpLatLng=new google.maps.LatLng(n.latitude,n.longitude),n.name?markerText="<b>"+n.name+"</b><br><a href='/places/"+n.slug+"/'>"+n.name+"</a>":markerText=n.name;var t=new google.maps.Marker({map:s,position:tmpLatLng,title:markerText,animation:google.maps.Animation.DROP,url:"/places/"+n.slug+"/"});d.extend(tmpLatLng),f(t,s,l,markerText),r.push(t),g.addMarker(t),s.fitBounds(d)}})}var i=n+1,s=new google.maps.Map(document.getElementById("map"+i),a),r=[],g=new MarkerClusterer(s),m=!0,l=new google.maps.InfoWindow({content:""}),d=new google.maps.LatLngBounds,p=$(this).find(".sense_id").text(),u=$(this).find(".artist-slug").text(),c=$(this).find(".place-slug").text();u?(e="/data/artists/"+u+"/",m=!1):c?(e="/data/places/"+c+"/",m=!1):e="/data/senses/"+p+"/artists/",$.getJSON(e,{csrfmiddlewaretoken:"{{csrf_token}}"},function(e){u?t(e.artists):c?o(e.places):t(e.senses)}),m||(zoomChangeBoundsListener=google.maps.event.addListener(s,"bounds_changed",function(e){this.setZoom(10)}));var f=function(e,n,t,a){google.maps.event.addListener(e,"click",function(){t.setContent(a),t.open(n,e)})}})}google.maps.event.addDomListener(window,"load",e)})});